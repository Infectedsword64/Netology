--- Задание 2
-- 1
SELECT
	TITLE,
	DURATION
FROM
	SONG
WHERE
	DURATION = (
		SELECT
			MAX(DURATION)
		FROM
			SONG
	);

--2
SELECT
	TITLE
FROM
	SONG
WHERE
	DURATION >= 210;

--3
SELECT
	TITLE
FROM
	COLLECTION
WHERE
	YEAR >= 2018
	AND YEAR <= 2020;

--4
SELECT
	NAME
FROM
	PERFORMER
WHERE
	NAME NOT LIKE '% %';

--5
SELECT
	TITLE
FROM
	SONG
WHERE
	TITLE ILIKE 'my %'
	OR TITLE ILIKE '% my'
	OR TITLE ILIKE '% my %'
	OR TITLE ILIKE 'my'
	OR TITLE ILIKE 'мой %'
	OR TITLE ILIKE '% мой'
	OR TITLE ILIKE '% мой %'
	OR TITLE ILIKE 'мой';

--- Задание 3
--1
SELECT
	GENRE.TITLE,
	COUNT(*)
FROM
	GENREPERFORMER G
	JOIN GENRE ON G.GENRE_ID = GENRE.ID
	JOIN PERFORMER ON G.PERFORMER_ID = PERFORMER.ID
GROUP BY
	TITLE
ORDER BY
	COUNT(*) DESC;

--2
SELECT
	COUNT(SONG.TITLE) AS COUNT_SONG
FROM
	ALBUM
	JOIN SONG ON ALBUM.ID = SONG.ALBUM_ID
WHERE
	YEAR BETWEEN 2019 AND 2020;

--3
SELECT
	ALBUM.TITLE,
	AVG(SONG.DURATION)
FROM
	ALBUM
	JOIN SONG ON ALBUM.ID = SONG.ALBUM_ID
GROUP BY
	ALBUM.TITLE;

--4
SELECT
	NAME
FROM
	PERFORMER
WHERE
	NAME NOT IN (
		SELECT
			NAME
		FROM
			PERFORMER
			JOIN PERFORMERALBUM PA ON PERFORMER.ID = PA.PERFORMER_ID
			JOIN ALBUM ON ALBUM.ID = PA.ALBUM_ID
		WHERE
			ALBUM.YEAR = 2020
	);

--5
SELECT DISTINCT
	COLLECTION.TITLE,
	PERFORMER.NAME
FROM
	COLLECTIONSONG C
	JOIN COLLECTION ON C.COLLECTION_ID = COLLECTION.ID
	JOIN SONG ON C.SONG_ID = SONG.ID
	JOIN ALBUM ON SONG.ALBUM_ID = ALBUM.ID
	JOIN PERFORMERALBUM P ON ALBUM.ID = P.ALBUM_ID
	JOIN PERFORMER ON P.PERFORMER_ID = PERFORMER.ID WHERE
	PERFORMER.NAME LIKE 'Король и шут';

SELECT
	*
FROM
	SONG;